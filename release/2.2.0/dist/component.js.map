{"version":3,"file":"component.js","sources":["../src/Component.ts"],"sourcesContent":["/*\n * Copyright (c) 2015 NAVER Corp.\n * egjs projects are licensed under the MIT license\n */\n\nfunction isUndefined(value: any): boolean {\n    return typeof value === \"undefined\";\n}\n\ninterface DefaultProps<T> {\n  eventType: string;\n  stop: () => void;\n  currentTarget: T;\n}\n\ntype EventNoParamKey<T extends EventMap, K extends EventKey<T>> = T[K] extends NoArguments\n  ? K\n  : never;\ntype NotFunction = { [k: string]: unknown } & ({ bind?: never } | { call?: never });\ntype NoArguments = undefined | null | void | never;\ntype EventWithRestParam = ((evt: NotFunction, ...restParam: any[]) => any);\n\n/**\n * Types that can be used when attaching new event definition as generic on a class\n * @ko 클래스 타입 등록시 사용가능한 타입\n * @example\n * new SomeClass<{\n *   // Using it as object\n *   evt0: {\n *     param0: number;\n *     param1: string\n *   };\n *   // Using it as function with other arguments\n *   evt1: (arg0: {\n *     param0: number;\n *     param1: string\n *   }, arg1: string, arg2: boolean) => boolean;\n * }>\n */\ntype EventDefinition = NotFunction | NoArguments | EventWithRestParam;\n\ntype EventMap = Record<string, EventDefinition>;\ntype EventKey<T extends EventMap> = string & keyof T;\ntype EventHash<T extends EventMap, S> = Partial<{ [K in EventKey<T>]: EventCallback<T, K, S> }>;\n\ntype EventCallback<T extends EventMap, K extends EventKey<T>, S>\n  = T[K] extends NoArguments\n    ? (event: DefaultProps<S>) => any\n    : T[K] extends (evt: infer U, ...restParam: infer V) => any\n      ? (event: U & DefaultProps<S>, ...restParam: V) => any\n      : (event: T[K] & DefaultProps<S>) => any;\ntype FirstParam<T extends EventMap, K extends EventKey<T>>\n  = T[K] extends NoArguments\n    ? void\n    : T[K] extends (evt: infer U, ...restParam: any[]) => any\n      ? U\n      : T[K];\ntype RestParam<T extends EventMap, K extends EventKey<T>>\n  = T[K] extends (evt: NotFunction, ...restParam: infer U) => any\n    ? U\n    : void[]\n\n/**\n * A class used to manage events in a component\n * @ko 컴포넌트의 이벤트을 관리할 수 있게 하는 클래스\n * @alias eg.Component\n */\nclass Component<T extends EventMap = EventMap> {\n  /**\n   * Version info string\n   * @ko 버전정보 문자열\n   * @name VERSION\n   * @static\n   * @type {String}\n   * @example\n   * eg.Component.VERSION;  // ex) 2.0.0\n   * @memberof eg.Component\n   */\n  public static VERSION: string = \"#__VERSION__#\";\n\n  /**\n   * @deprecated\n   */\n  public options: {[key: string]: any} = {};\n  private _eventHandler: {[keys: string]: EventCallback<T, EventKey<T>, Component<T>>[]};\n\n  /**\n   * @support {\"ie\": \"7+\", \"ch\" : \"latest\", \"ff\" : \"latest\",  \"sf\" : \"latest\", \"edge\" : \"latest\", \"ios\" : \"7+\", \"an\" : \"2.1+ (except 3.x)\"}\n   */\n  constructor() {\n    this._eventHandler = {};\n  }\n\n  /**\n   * Triggers a custom event.\n   * @ko 커스텀 이벤트를 발생시킨다\n   * @param {String} eventName The name of the custom event to be triggered <ko>발생할 커스텀 이벤트의 이름</ko>\n   * @param {Object} customEvent Event data to be sent when triggering a custom event <ko>커스텀 이벤트가 발생할 때 전달할 데이터</ko>\n   * @return {Boolean} Indicates whether the event has occurred. If the stop() method is called by a custom event handler, it will return false and prevent the event from occurring. <a href=\"https://github.com/naver/egjs-component/wiki/How-to-make-Component-event-design%3F\">Ref</a> <ko>이벤트 발생 여부. 커스텀 이벤트 핸들러에서 stop() 메서드를 호출하면 'false'를 반환하고 이벤트 발생을 중단한다. <a href=\"https://github.com/naver/egjs-component/wiki/How-to-make-Component-event-design%3F\">참고</a></ko>\n   * @example\n   * class Some extends eg.Component {\n   *   some(){\n   *     if(this.trigger(\"beforeHi\")){ // When event call to stop return false.\n   *       this.trigger(\"hi\");// fire hi event.\n   *     }\n   *   }\n   * }\n   *\n   * const some = new Some();\n   * some.on(\"beforeHi\", (e) => {\n   *   if(condition){\n   *     e.stop(); // When event call to stop, `hi` event not call.\n   *   }\n   * });\n   * some.on(\"hi\", (e) => {\n   *   // `currentTarget` is component instance.\n   *   console.log(some === e.currentTarget); // true\n   * });\n   * // If you want to more know event design. You can see article.\n   * // https://github.com/naver/egjs-component/wiki/How-to-make-Component-event-design%3F\n   */\n  public trigger<K extends EventKey<T>>(eventName: EventNoParamKey<T, K>): boolean;\n  public trigger<K extends EventKey<T>>(eventName: K, customEvent: FirstParam<T, K>, ...restParam: RestParam<T, K>): boolean;\n  public trigger<K extends EventKey<T>>(eventName: K, customEvent?: FirstParam<T, K>, ...restParam: any[]): boolean {\n    let handlerList = this._eventHandler[eventName] || [];\n    const hasHandlerList = handlerList.length > 0;\n\n    if (!hasHandlerList) {\n      return true;\n    }\n    if (!customEvent) {\n      customEvent = {} as any;\n    }\n\n    // If detach method call in handler in first time then handler list calls.\n    handlerList = handlerList.concat();\n\n    let isCanceled = false;\n\n    // This should be done like this to pass previous tests\n    (customEvent as any).eventType = eventName;\n    (customEvent as any).stop = () => { isCanceled = true; };\n    (customEvent as any).currentTarget = this;\n\n    let arg: any[] = [customEvent];\n\n    if (restParam.length >= 1) {\n      arg = arg.concat(restParam);\n    }\n\n    handlerList.forEach(handler => {\n      handler.apply(this, arg);\n    });\n\n    return !isCanceled;\n  }\n\n  /**\n   * Executed event just one time.\n   * @ko 이벤트가 한번만 실행된다.\n   * @param {eventName} eventName The name of the event to be attached <ko>등록할 이벤트의 이름</ko>\n   * @param {Function} handlerToAttach The handler function of the event to be attached <ko>등록할 이벤트의 핸들러 함수</ko>\n   * @return {eg.Component} An instance of a component itself<ko>컴포넌트 자신의 인스턴스</ko>\n   * @example\n   * class Some extends eg.Component {\n   * hi() {\n   *   alert(\"hi\");\n   * }\n   * thing() {\n   *   this.once(\"hi\", this.hi);\n   * }\n   * }\n   *\n   * var some = new Some();\n   * some.thing();\n   * some.trigger(\"hi\");\n   * // fire alert(\"hi\");\n   * some.trigger(\"hi\");\n   * // Nothing happens\n   */\n  public once<K extends EventKey<T>>(eventName: K, handlerToAttach: EventCallback<T, K, this>): this;\n  public once(eventHash: EventHash<T, this>): this;\n  public once<K extends EventKey<T>>(eventName: K | EventHash<T, this>, handlerToAttach?: EventCallback<T, K, this>): this {\n    if (typeof eventName === \"object\" && isUndefined(handlerToAttach)) {\n      const eventHash = eventName;\n\n      for (const key in eventHash) {\n        this.once((key as K), eventHash[key] as EventCallback<T, K, this>);\n      }\n      return this;\n    } else if (typeof eventName === \"string\" && typeof handlerToAttach === \"function\") {\n      const listener: any = (...args: any[]) => {\n        handlerToAttach.apply(this, args);\n        this.off(eventName, listener);\n      }\n\n      this.on(eventName, listener);\n    }\n\n    return this;\n  }\n\n  /**\n   * Checks whether an event has been attached to a component.\n   * @ko 컴포넌트에 이벤트가 등록됐는지 확인한다.\n   * @param {String} eventName The name of the event to be attached <ko>등록 여부를 확인할 이벤트의 이름</ko>\n   * @return {Boolean} Indicates whether the event is attached. <ko>이벤트 등록 여부</ko>\n   * @example\n   * class Some extends eg.Component {\n   *   some() {\n   *     this.hasOn(\"hi\");// check hi event.\n   *   }\n   * }\n   */\n  public hasOn<K extends EventKey<T>>(eventName: K): boolean {\n    return !!this._eventHandler[eventName];\n  }\n\n  /**\n   * Attaches an event to a component.\n   * @ko 컴포넌트에 이벤트를 등록한다.\n   * @param {eventName} eventName The name of the event to be attached <ko>등록할 이벤트의 이름</ko>\n   * @param {Function} handlerToAttach The handler function of the event to be attached <ko>등록할 이벤트의 핸들러 함수</ko>\n   * @return {eg.Component} An instance of a component itself<ko>컴포넌트 자신의 인스턴스</ko>\n   * @example\n   * class Some extends eg.Component {\n   *   hi() {\n   *     console.log(\"hi\");\n   *   }\n   *   some() {\n   *     this.on(\"hi\",this.hi); //attach event\n   *   }\n   * }\n   */\n  public on<K extends EventKey<T>>(eventName: K, handlerToAttach: EventCallback<T, K, this>): this;\n  public on(eventHash: EventHash<T, this>): this;\n  public on<K extends EventKey<T>>(eventName: K | EventHash<T, this>, handlerToAttach?: EventCallback<T, K, this>): this {\n    if (typeof eventName === \"object\" && isUndefined(handlerToAttach)) {\n      const eventHash = eventName;\n\n      for (const name in eventHash) {\n        this.on(name, eventHash[name] as any);\n      }\n\n      return this;\n    } else if (typeof eventName === \"string\" &&\n      typeof handlerToAttach === \"function\") {\n      let handlerList = this._eventHandler[eventName];\n\n      if (isUndefined(handlerList)) {\n        this._eventHandler[eventName] = [];\n        handlerList = this._eventHandler[eventName];\n      }\n\n      handlerList.push(handlerToAttach as EventCallback<T, EventKey<T>, this>);\n    }\n\n    return this;\n  }\n\n  /**\n   * Detaches an event from the component.\n   * @ko 컴포넌트에 등록된 이벤트를 해제한다\n   * @param {eventName} eventName The name of the event to be detached <ko>해제할 이벤트의 이름</ko>\n   * @param {Function} handlerToDetach The handler function of the event to be detached <ko>해제할 이벤트의 핸들러 함수</ko>\n   * @return {eg.Component} An instance of a component itself <ko>컴포넌트 자신의 인스턴스</ko>\n   * @example\n   * class Some extends eg.Component {\n   *   hi() {\n   *     console.log(\"hi\");\n   *   }\n   *   some() {\n   *     this.off(\"hi\",this.hi); //detach event\n   *   }\n   * }\n   */\n  public off(eventHash?: EventHash<T, this>): this;\n  public off<K extends EventKey<T>>(eventName: K, handlerToDetach?: EventCallback<T, K, this>): this;\n  public off<K extends EventKey<T>>(eventName?: K | EventHash<T, this>, handlerToDetach?: EventCallback<T, K, this>): this {\n    // Detach all event handlers.\n    if (isUndefined(eventName)) {\n      this._eventHandler = {};\n      return this;\n    }\n\n    // Detach all handlers for eventname or detach event handlers by object.\n    if (isUndefined(handlerToDetach)) {\n      if (typeof eventName === \"string\") {\n        delete this._eventHandler[eventName];\n        return this;\n      } else {\n        const eventHash = eventName;\n\n        for (const name in eventHash) {\n          this.off(name, eventHash[name] as any);\n        }\n        return this;\n      }\n    }\n\n    // Detach single event handler\n    const handlerList = this._eventHandler[eventName as K];\n\n    if (handlerList) {\n      let idx = 0;\n      for (const handlerFunction of handlerList) {\n        if (handlerFunction === handlerToDetach) {\n          handlerList.splice(idx, 1);\n          break;\n        }\n        idx++;\n      }\n    }\n\n    return this;\n  }\n}\n\nexport default Component;\n"],"names":["isUndefined","value","_eventHandler","eventName","customEvent","_i","restParam","handlerList","hasHandlerList","length","concat","isCanceled","eventType","stop","currentTarget","arg","forEach","handler","apply","_this","handlerToAttach","eventHash","key","once","listener_1","args","off","on","name","push","handlerToDetach","idx","handlerList_1","__values","handlerFunction","splice","Component"],"mappings":"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"}